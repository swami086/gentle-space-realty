# üìä Production Monitoring & Maintenance Procedures

## Overview üéØ

This document outlines comprehensive monitoring, maintenance, and operational procedures for the Gentle Space Realty production environment. It includes proactive monitoring strategies, maintenance schedules, performance optimization, and emergency response procedures.

## System Health Monitoring üíä

### Application Health Checks

**Primary Health Endpoint**: `GET /api/health`
```javascript
// Health check response structure
{
  "status": "healthy",
  "timestamp": "2025-09-13T15:30:00.000Z",
  "uptime": 3600,
  "version": "1.0.0",
  "environment": "production",
  "dependencies": {
    "database": "connected",
    "blobStorage": "accessible", 
    "emailService": "operational",
    "externalAPIs": "responsive"
  },
  "metrics": {
    "memoryUsage": "245MB",
    "cpuUsage": "15%",
    "requestCount": 1250,
    "errorRate": "0.1%"
  }
}\n```\n\n**Health Check Schedule**:\n- ‚úÖ Every 30 seconds: Uptime monitoring\n- ‚úÖ Every 5 minutes: Dependency health\n- ‚úÖ Every 15 minutes: Performance metrics\n- ‚úÖ Every hour: Detailed system diagnostics\n\n### Database Health Monitoring\n\n**Connection Pool Monitoring**:\n```sql\n-- Active connections\nSELECT count(*) as active_connections \nFROM pg_stat_activity \nWHERE state = 'active';\n\n-- Long-running queries\nSELECT query, state, query_start, now() - query_start as duration\nFROM pg_stat_activity \nWHERE now() - query_start > interval '1 minute';\n\n-- Database size growth\nSELECT pg_size_pretty(pg_database_size('gentle_space_realty'));\n```\n\n**Database Alerts**:\n- üö® Connection pool >80% utilization\n- üö® Queries running >2 minutes\n- ‚ö†Ô∏è Database size growth >10% weekly\n- ‚ö†Ô∏è Backup failure notifications\n\n### API Performance Monitoring\n\n**Key Performance Indicators**:\n```javascript\n// Response time thresholds\nconst performanceThresholds = {\n  '/api/properties': 200,      // 200ms average\n  '/api/auth/login': 100,      // 100ms average  \n  '/api/inquiries': 150,       // 150ms average\n  '/api/uploads': 2000,        // 2s average\n  '/api/health': 50            // 50ms average\n};\n\n// Error rate thresholds\nconst errorThresholds = {\n  '4xx': 5,    // 5% client errors acceptable\n  '5xx': 0.5,  // 0.5% server errors maximum\n  total: 2     // 2% total error rate maximum\n};\n```\n\n**Performance Alerts**:\n- üö® Response time >2x threshold for >5 minutes\n- üö® Error rate >5% for >2 minutes\n- ‚ö†Ô∏è Response time >1.5x threshold for >10 minutes\n- ‚ö†Ô∏è Unusual traffic patterns (>3x normal volume)\n\n## Uptime & Availability Monitoring üåê\n\n### External Monitoring Services\n\n**Uptime Robot Configuration**:\n```yaml\nmonitors:\n  - name: \"Gentle Space Realty - Main Site\"\n    url: \"https://your-domain.com\"\n    type: \"HTTP\"\n    interval: 300  # 5 minutes\n    timeout: 30\n    alert_contacts: [\"email\", \"sms\"]\n    \n  - name: \"API Health Check\"  \n    url: \"https://your-domain.com/api/health\"\n    type: \"HTTP\"\n    interval: 60   # 1 minute\n    timeout: 10\n    expected_status: 200\n    \n  - name: \"Admin Dashboard\"\n    url: \"https://your-domain.com/admin\"\n    type: \"HTTP\"\n    interval: 600  # 10 minutes\n    timeout: 30\n```\n\n**Availability Targets**:\n- üéØ **99.9% uptime** (8.7 hours downtime per year)\n- üéØ **<200ms average response time**\n- üéØ **<2% error rate**\n- üéØ **<30 seconds recovery time** for transient issues\n\n### Geographic Monitoring\n\n**Multi-location Checks**:\n- ‚úÖ North America (Primary)\n- ‚úÖ Europe (Secondary) \n- ‚úÖ Asia Pacific (Tertiary)\n\n**CDN Performance Monitoring**:\n- Edge location response times\n- Cache hit ratios\n- Geographic user experience\n\n## Error Tracking & Logging üìù\n\n### Centralized Logging with Sentry\n\n**Error Classification**:\n```javascript\n// Critical errors (immediate alert)\nconst criticalErrors = [\n  'DatabaseConnectionError',\n  'AuthenticationSystemFailure', \n  'PaymentProcessingError',\n  'DataCorruptionError'\n];\n\n// High priority errors (30 minute alert)\nconst highPriorityErrors = [\n  'EmailDeliveryFailure',\n  'FileUploadError',\n  'ExternalAPITimeout',\n  'RateLimitExceeded'\n];\n\n// Monitor and log but no immediate alert\nconst monitoredErrors = [\n  'ValidationError',\n  'NotFoundError', \n  'UserInputError',\n  'CacheError'\n];\n```\n\n**Log Levels and Retention**:\n```javascript\nconst logConfig = {\n  levels: {\n    error: 0,    // Keep for 90 days\n    warn: 1,     // Keep for 30 days  \n    info: 2,     // Keep for 14 days\n    debug: 3     // Keep for 7 days (dev only)\n  },\n  transports: {\n    sentry: ['error', 'warn'],\n    file: ['error', 'warn', 'info'],\n    console: ['error', 'warn', 'info'] // production\n  }\n};\n```\n\n### Security Event Monitoring\n\n**Security Alerts**:\n```javascript\n// Immediate security alerts\nconst securityEvents = {\n  'multiple_failed_logins': {\n    threshold: 5,\n    timeWindow: '5 minutes',\n    action: 'block_ip_temporarily'\n  },\n  'admin_access_unusual_location': {\n    threshold: 1,\n    action: 'require_mfa_verification'\n  },\n  'bulk_data_access': {\n    threshold: 1000, // records\n    timeWindow: '1 minute',\n    action: 'alert_security_team'\n  },\n  'sql_injection_attempt': {\n    threshold: 1,\n    action: 'block_ip_immediately'\n  }\n};\n```\n\n## Performance Optimization Monitoring üöÄ\n\n### Core Web Vitals Tracking\n\n**Performance Metrics**:\n```javascript\n// Google Core Web Vitals targets\nconst webVitalsTargets = {\n  'Largest Contentful Paint (LCP)': '2.5s',\n  'First Input Delay (FID)': '100ms', \n  'Cumulative Layout Shift (CLS)': '0.1',\n  'First Contentful Paint (FCP)': '1.8s',\n  'Time to Interactive (TTI)': '3.8s'\n};\n\n// Real User Monitoring (RUM)\nconst rumTracking = {\n  sampleRate: 0.1,  // Track 10% of users\n  trackingEvents: [\n    'page_load',\n    'route_change', \n    'form_submission',\n    'image_load',\n    'api_call'\n  ]\n};\n```\n\n**Performance Alerts**:\n- üö® LCP >4.0s for >10% of users\n- üö® FID >300ms for >5% of users  \n- ‚ö†Ô∏è CLS >0.25 for >5% of users\n- ‚ö†Ô∏è Page load time trending upward >20%\n\n### Database Performance Monitoring\n\n**Query Performance Tracking**:\n```sql\n-- Slow query monitoring\nSELECT query, calls, total_time, mean_time, stddev_time\nFROM pg_stat_statements \nORDER BY mean_time DESC \nLIMIT 10;\n\n-- Index usage analysis\nSELECT schemaname, tablename, indexname, idx_scan, idx_tup_read, idx_tup_fetch\nFROM pg_stat_user_indexes\nWHERE idx_scan < 10 AND idx_tup_read > 0;\n\n-- Table bloat monitoring \nSELECT schemaname, tablename, \n  pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) as size,\n  pg_size_pretty(pg_relation_size(schemaname||'.'||tablename)) as table_size\nFROM pg_tables \nWHERE schemaname = 'public'\nORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;\n```\n\n**Database Optimization Alerts**:\n- üö® Query execution time >5 seconds\n- ‚ö†Ô∏è Unused indexes consuming >100MB\n- ‚ö†Ô∏è Table bloat >30%\n- ‚ö†Ô∏è Connection pool utilization >90%\n\n## Business Metrics Monitoring üìà\n\n### Key Business Indicators\n\n**Daily KPIs**:\n```javascript\nconst businessMetrics = {\n  userEngagement: {\n    'daily_active_users': { target: 100, alert: '<50' },\n    'session_duration': { target: '5 minutes', alert: '<2 minutes' },\n    'bounce_rate': { target: '<40%', alert: '>60%' }\n  },\n  propertyMetrics: {\n    'property_views': { target: 500, alert: '<200' },\n    'inquiry_submissions': { target: 10, alert: '<3' },\n    'conversion_rate': { target: '2%', alert: '<1%' }\n  },\n  systemHealth: {\n    'email_delivery_rate': { target: '99%', alert: '<95%' },\n    'image_upload_success': { target: '99.5%', alert: '<98%' },\n    'search_performance': { target: '<500ms', alert: '>1000ms' }\n  }\n};\n```\n\n### Analytics Integration\n\n**Google Analytics 4 Events**:\n```javascript\n// Custom event tracking\nconst analyticsEvents = [\n  'property_view',\n  'inquiry_submission', \n  'contact_form_complete',\n  'image_gallery_interaction',\n  'search_performed',\n  'admin_login',\n  'property_status_change'\n];\n\n// Conversion goals\nconst conversionGoals = {\n  'inquiry_to_contact': '15%',\n  'view_to_inquiry': '3%', \n  'return_visitor_inquiry': '5%'\n};\n```\n\n## Automated Maintenance Procedures üîß\n\n### Daily Maintenance Tasks\n\n**Automated Daily Jobs**:\n```bash\n#!/bin/bash\n# daily-maintenance.sh - Runs at 2:00 AM UTC\n\necho \"$(date): Starting daily maintenance\"\n\n# Database maintenance\npsql $DATABASE_URL -c \"DELETE FROM analytics_events WHERE created_at < NOW() - INTERVAL '90 days';\"\npsql $DATABASE_URL -c \"DELETE FROM refresh_tokens WHERE expires_at < NOW();\"\npsql $DATABASE_URL -c \"VACUUM ANALYZE;\"\n\n# Log cleanup\nfind /logs -name \"*.log\" -mtime +30 -delete\n\n# Health check verification\ncurl -f https://your-domain.com/api/health || echo \"Health check failed!\"\n\n# Backup verification\nif [ -f \"/backups/backup_$(date +%Y%m%d).sql\" ]; then\n    echo \"Daily backup verified\"\nelse\n    echo \"ERROR: Daily backup missing!\"\nfi\n\necho \"$(date): Daily maintenance completed\"\n```\n\n### Weekly Maintenance Tasks\n\n**Automated Weekly Jobs** (Sundays 1:00 AM UTC):\n```bash\n#!/bin/bash\n# weekly-maintenance.sh\n\necho \"$(date): Starting weekly maintenance\"\n\n# Database optimization\npsql $DATABASE_URL -c \"REINDEX DATABASE gentle_space_realty;\"\npsql $DATABASE_URL -c \"ANALYZE;\"\n\n# Security log review\necho \"Reviewing security events from past week\"\n# Generate security report\n\n# Performance analysis\necho \"Analyzing performance trends\"\n# Generate performance report\n\n# Dependency check\nnpm audit --audit-level high\n\necho \"$(date): Weekly maintenance completed\"\n```\n\n### Monthly Maintenance Tasks\n\n**Monthly Review Checklist** (1st Sunday of each month):\n- [ ] Full security audit and penetration test\n- [ ] Database performance optimization review\n- [ ] SSL certificate expiry check\n- [ ] Backup and disaster recovery test\n- [ ] Dependency updates and security patches\n- [ ] Cost optimization analysis\n- [ ] Performance baseline review\n- [ ] User feedback analysis\n\n## Backup & Recovery Procedures üíæ\n\n### Automated Backup Strategy\n\n**Database Backups**:\n```bash\n#!/bin/bash\n# backup-database.sh - Runs daily at 3:00 AM UTC\n\nBACKUP_DIR=\"/backups\"\nDATE=$(date +%Y%m%d_%H%M%S)\nBACKUP_FILE=\"${BACKUP_DIR}/backup_${DATE}.sql\"\n\n# Create backup\npg_dump $DATABASE_URL > $BACKUP_FILE\n\n# Compress backup\ngzip $BACKUP_FILE\n\n# Upload to secure storage (implement based on your provider)\n# aws s3 cp $BACKUP_FILE.gz s3://your-backup-bucket/\n\n# Clean up old backups (keep 30 days)\nfind $BACKUP_DIR -name \"backup_*.sql.gz\" -mtime +30 -delete\n\necho \"Backup completed: $BACKUP_FILE.gz\"\n```\n\n**File Storage Backups**:\n```javascript\n// Vercel Blob backup strategy\nconst backupBlobs = async () => {\n  const blobs = await list();\n  \n  for (const blob of blobs.blobs) {\n    // Create redundant copies in different regions\n    await createBackupCopy(blob);\n  }\n  \n  console.log(`Backed up ${blobs.blobs.length} files`);\n};\n```\n\n### Recovery Procedures\n\n**Database Recovery**:\n```bash\n# Point-in-time recovery\npsql $DATABASE_URL < backup_YYYYMMDD_HHMMSS.sql\n\n# Verify recovery\npsql $DATABASE_URL -c \"SELECT count(*) FROM users;\"\npsql $DATABASE_URL -c \"SELECT count(*) FROM properties;\"\n```\n\n**Application Recovery**:\n1. **Vercel Deployment Rollback**:\n   - Access Vercel dashboard\n   - Navigate to Deployments\n   - Select previous stable deployment\n   - Click \"Promote to Production\"\n\n2. **Database Rollback**:\n   - Restore from most recent backup\n   - Verify data integrity\n   - Test application functionality\n\n3. **DNS/CDN Recovery**:\n   - Verify DNS settings\n   - Clear CDN cache\n   - Test from multiple locations\n\n## Alert Configuration & Escalation üö®\n\n### Alert Severity Levels\n\n**Critical (P0) - Immediate Response**:\n- Site completely down\n- Database unavailable  \n- Security breach detected\n- Data corruption identified\n- **Escalation**: SMS + Email + Slack\n- **Response Time**: 15 minutes\n\n**High (P1) - Quick Response**:\n- Partial functionality loss\n- Performance degradation >50%\n- Email delivery failures\n- Authentication issues\n- **Escalation**: Email + Slack\n- **Response Time**: 1 hour\n\n**Medium (P2) - Standard Response**:\n- Minor performance issues\n- Non-critical feature failures\n- High error rates\n- **Escalation**: Email\n- **Response Time**: 4 hours\n\n**Low (P3) - Informational**:\n- Performance trending down\n- Capacity warnings\n- Maintenance reminders\n- **Escalation**: Email (daily digest)\n- **Response Time**: Next business day\n\n### Contact Information\n\n**On-Call Rotation**:\n```yaml\nweek_1:\n  primary: \"Lead Developer\"\n  secondary: \"DevOps Engineer\" \n  backup: \"System Administrator\"\n  \nweek_2: \n  primary: \"DevOps Engineer\"\n  secondary: \"Lead Developer\"\n  backup: \"System Administrator\"\n```\n\n**Emergency Contacts**:\n- **Primary**: [Lead Developer Phone]\n- **Secondary**: [DevOps Engineer Phone]\n- **Management**: [Manager Phone]\n- **External Support**: [Hosting Provider Support]\n\n## Incident Response Procedures üöë\n\n### Incident Classification\n\n**Severity 1 (Critical)**:\n- Complete service outage\n- Security breach\n- Data loss\n- **Response**: Immediate (15 minutes)\n- **Communication**: All stakeholders\n\n**Severity 2 (High)**:\n- Significant feature outage\n- Performance degradation >50%\n- **Response**: 1 hour\n- **Communication**: Technical team + management\n\n**Severity 3 (Medium)**:\n- Minor feature issues\n- Performance issues <50%\n- **Response**: 4 hours\n- **Communication**: Technical team\n\n### Incident Response Workflow\n\n**Phase 1: Detection & Assessment (0-15 minutes)**:\n1. Incident detected via monitoring/alerts\n2. Assess severity and impact\n3. Page on-call engineer\n4. Create incident ticket\n5. Begin initial investigation\n\n**Phase 2: Response & Mitigation (15-60 minutes)**:\n1. Implement immediate fixes if available\n2. Communicate with stakeholders\n3. Escalate if needed\n4. Document actions taken\n5. Monitor for improvements\n\n**Phase 3: Resolution & Recovery (1-4 hours)**:\n1. Implement permanent fix\n2. Verify system stability\n3. Restore full functionality\n4. Update monitoring and alerts\n5. Communicate resolution\n\n**Phase 4: Post-Incident Review (24-48 hours)**:\n1. Conduct blameless post-mortem\n2. Document lessons learned\n3. Update procedures and runbooks\n4. Implement preventive measures\n5. Share findings with team\n\n## Monitoring Dashboard Configuration üì∫\n\n### Primary Dashboard KPIs\n\n**System Health Panel**:\n- ‚úÖ Application uptime %\n- ‚úÖ API response times (P50, P95, P99)\n- ‚úÖ Error rates by endpoint\n- ‚úÖ Database connection pool status\n- ‚úÖ Active user sessions\n\n**Business Metrics Panel**:\n- üìà Daily active users\n- üìà Property views\n- üìà Inquiry submissions \n- üìà Conversion rates\n- üìà Revenue metrics (if applicable)\n\n**Infrastructure Panel**:\n- üñ•Ô∏è CPU utilization\n- üíæ Memory usage\n- üóÑÔ∏è Database performance\n- üåê CDN performance\n- üíæ Storage utilization\n\n### Alert Integration\n\n**Notification Channels**:\n```yaml\nalert_channels:\n  email:\n    - \"team@company.com\"\n    - \"ops@company.com\"\n  slack:\n    - \"#alerts-critical\"\n    - \"#alerts-general\"\n  sms:\n    - \"+1234567890\"  # On-call engineer\n  webhook:\n    - \"https://your-incident-management-system.com/webhook\"\n```\n\n## Performance Baseline & SLA Targets üéØ\n\n### Service Level Agreements\n\n**Uptime SLA**: 99.9% (43.2 minutes downtime/month maximum)\n\n**Performance SLA**:\n- API response time: 95% of requests < 200ms\n- Page load time: 95% of pages < 3 seconds  \n- Database queries: 99% < 100ms\n- Image uploads: 95% < 5 seconds\n\n**Availability SLA**:\n- Core functionality: 99.9% uptime\n- Admin features: 99.5% uptime\n- File uploads: 99.0% uptime\n- Email notifications: 98.0% uptime\n\n### Performance Baselines\n\n**Current Baseline Metrics** (to be updated post-deployment):\n```javascript\nconst performanceBaselines = {\n  'homepage_load_time': '1.2s',\n  'property_search_time': '0.8s', \n  'inquiry_submission_time': '0.5s',\n  'admin_dashboard_load_time': '2.1s',\n  'image_upload_time': '3.2s',\n  'database_query_avg': '45ms',\n  'api_response_avg': '120ms'\n};\n```\n\n---\n\n## Monitoring Checklist Summary ‚úÖ\n\n### Daily Monitoring Tasks\n- [ ] Review overnight alerts and incidents\n- [ ] Check system health dashboard\n- [ ] Verify backup completion\n- [ ] Monitor error rates and performance\n- [ ] Review security logs\n\n### Weekly Monitoring Tasks  \n- [ ] Analyze performance trends\n- [ ] Review capacity utilization\n- [ ] Update monitoring thresholds\n- [ ] Test disaster recovery procedures\n- [ ] Security vulnerability scan\n\n### Monthly Monitoring Tasks\n- [ ] Full system performance review\n- [ ] SLA compliance assessment  \n- [ ] Monitoring tool optimization\n- [ ] Alert fatigue analysis\n- [ ] Disaster recovery drill\n\n**Monitoring Status**: ‚úÖ **PRODUCTION READY**\n\n*This monitoring framework provides comprehensive coverage of all critical system components and business metrics, ensuring proactive issue detection and rapid incident response.*